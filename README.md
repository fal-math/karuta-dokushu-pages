# かるた読手ツール

競技かるたの個人的な独習を支援するWebベースのツールです。
読み上げのリズムを可視化するタイマーと、美しい縦書き表示で、効率的な練習をサポートします。

## 主な機能

### 練習モード

- **全100首モード**: 1番から100番まで順番に出題されます。
- **札選択モード**: 練習したい札を自由に選択できます。
  - **決まり字選択**: 「むすめふさほせ」などの決まり字グループで一括選択が可能。
  - **選択数表示**: 現在選択されている札の枚数をリアルタイムで確認できます。
  - **シャッフル出題**: 選択した札をランダムな順序で出題するシャッフル機能を搭載。

### 視覚的タイマー

- 円グラフによる直感的な残り時間表示。
- 競技かるたのリズム（下の句読む -> 余韻 -> 間合い -> 上の句読む）を色分けしてガイドします。

### 表示・操作性

- **美しい縦書き表示**: ルビや字下げを含む、実際の札に近いレイアウトを実現。
- **レスポンシブデザイン**: スマートフォンとPCの両方で快適に利用可能。
- **状態の自動保存**: 選択した札や設定は `localStorage` に自動保存され、リロードしても続きから再開できます。
- **離脱防止**: 練習中の不用意なページ移動を防ぐ警告機能。

## 技術スタック

- **HTML5 / CSS3**: 変数 (`var(--)`) を活用したモダンなCSS設計。
- **Vanilla JavaScript (ES Modules)**: フレームワークに依存しない軽量な設計。
- **JSDoc**: 型定義とドキュメント化による保守性の向上。
- **Playwright**: E2Eテストによる品質保証。

## ファイル構成

主要なファイルとディレクトリの構成は以下の通りです。

```text
/
├── index.html          # エントリポイント
├── src/
│   ├── css/            # スタイルシート (CSS Modules的な分割)
│   ├── data/           # 百人一首データ (JSON)
│   └── js/             # アプリケーションロジック
│       ├── main.js     # アプリケーションの初期化とイベント制御
│       ├── flow.js     # 練習フロー（ステートマシン）の制御
│       ├── picker.js   # 札選択画面（Picker UI）のロジック
│       ├── timer.js    # 円グラフタイマーの描画と制御
│       ├── cardRender.js # 札（縦書きテキスト）のレンダリング
│       ├── constants.js # 定数定義（設定値など）
│       ├── state.js    # アプリケーションの状態管理
│       ├── storage.js  # localStorageへの永続化処理
│       ├── api.js      # JSDoc型定義
│       └── utils/      # ユーティリティ関数
├── tests/              # PlaywrightによるE2Eテスト
└── package.json        # 依存関係とスクリプト定義
```

## 開発と実行

### セットアップ

必要な依存関係をインストールします。

```bash
npm install
```

### 開発サーバーの起動

ローカルサーバーを立ち上げてアプリを確認します。

```bash
npm start
```

ブラウザで [http://127.0.0.1:3333](http://127.0.0.1:3333) にアクセスしてください。

### テストの実行

PlaywrightによるE2Eテストを実行します。

```bash
npm test
```
